<!DOCTYPE html>
<meta charset="utf-8">

<link href="nv.d3.css" rel="stylesheet" type="text/css">

<style>
    #chart {
        height: 1000px;
    }

    #chart g.nv-scatter g.nv-series-0 path.nv-point {
        fill-opacity: 1;
        stroke-opacity: 1;
    }

    #chart g.nv-series-0 path.nv-line {
        stroke-opacity: 1;
    }
</style>

<body>

    <div><svg id="chart"></svg></div>

    <script src="d3.v3.js"></script>
    <script src="nv.d3.js"></script>

    <script>

        d3.csv("test.csv", function (csv) {

            nv.addGraph(function () {
                var chart = nv.models.lineChart();
                // .margin({ left: 100 })  //Adjust chart margins to give the x-axis some breathing room.
                // .useInteractiveGuideline(true)  //We want nice looking tooltips and a guideline!
                // .transitionDuration(350)  //how fast do you want the lines to transition?
                // .showLegend(true)       //Show the legend, allowing users to turn on/off line series.
                // .showYAxis(true)        //Show the y-axis
                // .showXAxis(true)        //Show the x-axis

                var myData = finalSeries();   //You need data...
                var array = Object.values(finalSeries()[0])[0];

                console.log(myData);

                chart.xAxis     //Chart x-axis settings
                    .axisLabel('Year')

                chart.yAxis     //Chart y-axis settings
                    .axisLabel('Value')

                // chart.yDomain([Math.round(Math.min.apply(Math, array.map(function (o) { return o.y; })) - 5), Math.round(Math.max.apply(Math, array.map(function (o) { return o.y; })) + 5)])

                /* Done setting the chart up? Time to render it!*/


                d3.select('#chart')    //Select the <svg> element you want to render the chart in.   
                    .datum(myData)         //Populate the <svg> element with chart data...
                    .transition().duration(500)
                    .call(chart);          //Finally, render the chart!

                //Update the chart when window resizes.
                nv.utils.windowResize(function () { chart.update() });
                return chart;
            });

            // nv.addGraph(function () {
            //     var chart1 = nv.models.scatterChart()
            //         .showDistX(false)
            //         .showDistY(false)
            //         .transitionDuration(700)
            //         .color(d3.scale.category10().range());

            //     chart1.tooltipContent(function (key) {
            //         return '<h3>' + key + '</h3 > ';
            //     });

            //     // chart1.xAxis     //Chart x-axis settings
            //     //     .axisLabel('Year')

            //     // chart1.yAxis     //Chart y-axis settings
            //     //     .axisLabel('Value')

            //     // chart1.xAxis.tickFormat(d3.format('.02f'));
            //     // chart1.yAxis.tickFormat(d3.format('0.2f'));

            //     chart1.scatter.onlyCircles(false);

            //     var myData1 = sourceSeries()

            //     console.log(myData1)

            //     d3.select('#chart')
            //         .datum(myData1)
            //         .call(chart1)

            //     nv.utils.windowResize(function () { chart1.update() });
            //     return chart1;
            // });

            function finalSeries() {
                var F1 = [];
                var S1 = [];

                for (var i = 0; i < csv.length; i++) {
                    F1.push({ x: csv[i].year, y: csv[i].F1, shape: 'square' });
                    S1.push({ x: csv[i].year, y: csv[i].S1 });

                }

                return [
                    {
                        values: F1,      //values - represents the array of {x,y} data points
                        key: 'F1', //key  - the name of the series.
                        color: '#ff7f0e'  //color - optional: choose your own line color.
                    },
                    {
                        values: S1,      //values - represents the array of {x,y} data points
                        key: 'S1', //key  - the name of the series.
                        color: '#ff7f0e'  //color - optional: choose your own line color.
                    },
                ];
            }

            // function sourceSeries() {
            //     var series1 = [];

            //     for (var i = 0; i < csv.length; i++) {
            //         series1.push({ x: csv[i].year, y: csv[i].F1, z: csv[i].S1 });
            //     }

            //     return [
            //         {
            //             values: series1,      //values - represents the array of {x,y} data points
            //             key: 'Source series', //key  - the name of the series.
            //             color: '#ff7f0e'  //color - optional: choose your own line color.
            //         },
            //     ];
            // }

        });

    </script>

    </html>